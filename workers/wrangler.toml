# Cloudflare Workers Configuration for Fitso.me Sync API
name = "fitsome-sync-api"
main = "src/index.ts"
compatibility_date = "2025-01-01"

# Environment variables (set via Cloudflare dashboard or wrangler secret)
# RESEND_API_KEY - for sending magic link emails
# JWT_SECRET - for signing session tokens

[vars]
ENVIRONMENT = "development"
APP_URL = "http://localhost:5173"
CORS_ORIGINS = "http://localhost:5173,https://fitso.me"

# R2 Storage Bucket - single bucket for all user data
# Structure: {userId}/data.json (metadata) and {userId}/images/{hash} (images)
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "fitsome-data"
preview_bucket_name = "fitsome-data-preview"

# KV Namespace for auth tokens and rate limiting
[[kv_namespaces]]
binding = "AUTH_KV"
id = "1e05150bfcbf412fb1c02a8012b939be"
preview_id = "7c2ad6286e974f8bbba6d9d657862904"

# Production environment
[env.production]
vars = { ENVIRONMENT = "production", APP_URL = "https://fitso.me", CORS_ORIGINS = "https://fitso.me,https://www.fitso.me,http://localhost:5173,http://localhost:4173" }

[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "fitsome-data"

[[env.production.kv_namespaces]]
binding = "AUTH_KV"
id = "1e05150bfcbf412fb1c02a8012b939be"

